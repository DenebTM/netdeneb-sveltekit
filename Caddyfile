{
  auto_https off
}

(thefiles) {
  file_server {
    browse /caddy/browse-thumbs.html
  }
}

http://files.netdeneb.com {
  root * /caddy/static/files
  encode gzip zstd

  import thefiles
}

:80 {
  root * /caddy/static
  encode gzip zstd

  # use caddy file browser for /files
  redir /files /files/
  handle /files/* {
    import thefiles
  }

  import /etc/caddy/caddy-auth.conf

  redir /ftpfile /files{uri}
  redir /getfile /files{uri}

  route {
    # serve existing files in /img, /art and /thumbs
    file_server {
      pass_thru
    }

    # pass everything else to reverse proxy
    reverse_proxy localhost:3000
  }
}
